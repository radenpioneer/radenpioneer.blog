---
import BaseLayout, { type Props as BaseLayoutProps } from './base.astro'
import Header from '~/components/header.astro'
import Sidebar from '~/components/sidebar.astro'
import { getEntry } from 'astro:content'

export interface Props extends BaseLayoutProps {
  title?: string
  description?: string
  hidden?: boolean
}

const { title, description, hidden, ...props } = Astro.props
const site = await getEntry('site', 'site')
---

<BaseLayout {...props} x-bind:class='$store.isSidebarOpen && "__inert"' x-data>
  <Header site={site!} />
  <slot />
  <Sidebar site={site!} />

  <Fragment slot='head'>
    <title>
      {title ? `${title} \u2014 ${site?.data.title}` : site?.data.title}
    </title>
    <meta name='description' content={description ?? site?.data.description} />
    <meta name='color-scheme' content='light dark' />
    <link rel='icon' type='image/svg+xml' href='/favicon.svg' />
    <link rel='icon' href='/favicon.ico' />
    <slot name='head' />
    {hidden && <meta name='robots' content='noindex, nofollow' />}
  </Fragment>
</BaseLayout>

<style lang='scss'>
  body {
    min-height: 100dvh;

    &.__inert {
      overflow: hidden;
    }
  }
</style>

<style lang='scss' is:global>
  @use '@picocss/pico/scss/pico' with (
    $theme-color: 'pumpkin'
  );

  [x-cloak] {
    display: none !important;
  }
</style>

<script>
  document.addEventListener('alpine:init', () => {
    // @ts-expect-error YNTKTS
    Alpine.store('isSidebarOpen', false)
  })
</script>
